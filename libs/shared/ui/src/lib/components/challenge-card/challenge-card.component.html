<mat-card class="challenge-card" [class.challenge-card--latest]="isLatestChallenge()">
  <div class="challenge-card__halo" aria-hidden="true"></div>

  <div class="challenge-card__header">
    <div class="challenge-card__header-left">
      <span class="challenge-card__category">{{ categoryLabel() }}</span>
      @if (hasNewBadge()) {
      <span class="challenge-card__badge">
        <mat-icon aria-hidden="true">sparkles</mat-icon>
        New
      </span>
      }
    </div>

    @if (docsAvailable()) {
    <button
      mat-icon-button
      class="challenge-card__docs-trigger"
      [matMenuTriggerFor]="docsMenu"
      matTooltip="View docs & resources"
      aria-label="View docs and resources"
      type="button"
    >
      <mat-icon>menu_book</mat-icon>
    </button>
    }
  </div>

  <mat-card-title class="challenge-card__title">
    {{ challenge().title }}
  </mat-card-title>

  <mat-card-content>
    <p class="challenge-card__description">
      {{ challenge().description }}
    </p>
  </mat-card-content>

  <mat-card-actions class="challenge-card__actions" role="group" aria-label="Challenge actions">
    <div class="challenge-card__primary-actions">
      <button
        mat-flat-button
        color="primary"
        type="button"
        (click)="onTryChallenge(challenge())"
        [disabled]="launching()"
        aria-label="Launch challenge in StackBlitz"
      >
        @if (launching()) {
          <mat-spinner diameter="20" aria-hidden="true"></mat-spinner>
          Launching...
        } @else {
          <ng-container>
            <mat-icon aria-hidden="true">rocket_launch</mat-icon>
            Launch challenge
          </ng-container>
        }
      </button>

      <button
        mat-stroked-button
        color="primary"
        type="button"
        (click)="viewOutput(challenge().link)"
        aria-label="View reference implementation"
      >
        <mat-icon aria-hidden="true">play_circle</mat-icon>
        View reference
      </button>
    </div>


  </mat-card-actions>

  <mat-menu #docsMenu="matMenu" class="challenge-card__menu">
    @if (challenge().requirement) {
      <button
        mat-menu-item
        type="button"
        (click)="openURL(challenge().requirement, 'requirement')"
      >
        <mat-icon aria-hidden="true">assignment</mat-icon>
        <span>Requirements</span>
      </button>
    }
    @if (challenge().solutionGuide) {
      <button
        mat-menu-item
        type="button"
        (click)="openURL(challenge().solutionGuide, 'solution')"
      >
        <mat-icon aria-hidden="true">lightbulb</mat-icon>
        <span>Solution guide</span>
      </button>
    }
    @if (challenge().gitHub) {
      <button
        mat-menu-item
        type="button"
        (click)="openURL(challenge().gitHub, 'github')"
      >
        <mat-icon aria-hidden="true">code</mat-icon>
        <span>GitHub source</span>
      </button>
    }
  </mat-menu>
</mat-card>
