<!-- Backdrop for mobile drawer/pills reveal (only for drawer mode) -->
@if (isMobile() && isOpen() && !isInlineMode()) {
  <div
    class="sidebar-backdrop"
    (click)="onBackdropClick()"
    aria-hidden="true"
  ></div>
}

<!-- Mobile Pills Reveal Panel (drawer mode only) -->
@if (isMobile() && !isInlineMode()) {
  <div
    class="pills-reveal-panel"
    [class.open]="isOpen()"
    role="navigation"
    aria-label="Challenge categories navigation"
  >
    <!-- Panel Header -->
    <div class="pills-header">
      <h2 class="pills-title">Explore Challenges by Category</h2>
      <p class="pills-caption">Master one challenge, at a time</p>
    </div>

    <!-- Carousel Container -->
    <div
      class="pills-carousel"
      [class.has-scroll-left]="showLeftArrow()"
      [class.no-scroll-right]="!showRightArrow()"
    >
      <!-- Left Arrow -->
      @if (shouldShowArrows() && showLeftArrow()) {
        <button
          class="carousel-arrow carousel-arrow-left"
          (click)="scrollLeft()"
          mat-icon-button
          aria-label="Scroll left"
        >
          <mat-icon>chevron_left</mat-icon>
        </button>
      }

      <!-- Pills Container -->
      <div
        #pillsContainer
        class="pills-container"
        (scroll)="onPillsScroll()"
        role="tablist"
      >
        @for (category of filteredCategories(); track category.id) {
          <button
            class="category-pill"
            [class.selected]="isSelected(category.id)"
            (click)="selectCategory(category.id)"
            role="tab"
            [attr.aria-label]="'Select ' + category.name + ' category'"
            [attr.aria-selected]="isSelected(category.id)"
          >
            <mat-icon class="pill-icon">{{ getCategoryIcon(category.id) }}</mat-icon>
            <span class="pill-text">{{ category.name }}</span>
            @if (category.challengeCount !== undefined) {
              <span class="pill-count">{{ category.challengeCount }}</span>
            }
          </button>
        }
      </div>

      <!-- Right Arrow -->
      @if (shouldShowArrows() && showRightArrow()) {
        <button
          class="carousel-arrow carousel-arrow-right"
          (click)="scrollRight()"
          mat-icon-button
          aria-label="Scroll right"
        >
          <mat-icon>chevron_right</mat-icon>
        </button>
      }
    </div>
  </div>
}

<!-- Inline Pills (embedded in parent toolbar) -->
@if (isInlineMode()) {
  <div
    class="inline-pills-wrapper"
    role="navigation"
    aria-label="Challenge categories navigation"
  >
    <!-- Compact Header -->
    <div class="inline-pills-header">
      <h2 class="inline-pills-title">Explore Challenges by Category</h2>
      <p class="inline-pills-caption">Master one challenge, at a time</p>
    </div>

    <div
      class="inline-pills-carousel"
      [class.has-scroll-left]="showLeftArrow()"
      [class.no-scroll-right]="!showRightArrow()"
    >
      <!-- Pills Container -->
      <div
        #pillsContainer
        class="inline-pills-container"
        (scroll)="onPillsScroll()"
        role="tablist"
      >
        @for (category of filteredCategories(); track category.id) {
          <button
            class="category-pill category-pill-compact"
            [class.selected]="isSelected(category.id)"
            (click)="selectCategory(category.id)"
            role="tab"
            [attr.aria-label]="'Select ' + category.name + ' category'"
            [attr.aria-selected]="isSelected(category.id)"
          >
            <span class="pill-text">{{ category.name }}</span>
            @if (category.challengeCount !== undefined) {
              <span class="pill-count">({{ category.challengeCount }})</span>
            }
          </button>
        }
      </div>
    </div>
  </div>
}

<!-- Desktop Sidebar -->
@if (!isMobile()) {
<aside
  class="category-sidebar"
  [class.open]="isOpen()"
  role="navigation"
  aria-label="Challenge categories navigation"
>
  <!-- Sidebar Header -->
  <div class="sidebar-header">
    <h2>Categories</h2>
  </div>

  <!-- Category List -->
  <div class="category-list">
    @if (hasNoResults()) {
      <div class="empty-state">
        <mat-icon class="empty-icon">search_off</mat-icon>
        <p class="empty-text">No categories found</p>
      </div>
    } @else {
      @for (category of filteredCategories(); track category.id) {
        <button
          class="category-item"
          [class.selected]="isSelected(category.id)"
          (click)="selectCategory(category.id)"
          [attr.aria-label]="'Select ' + category.name + ' category'"
          [attr.aria-current]="isSelected(category.id) ? 'page' : null"
        >
          <div class="category-content">

            <div class="category-info">
              <span class="category-name">{{ category.name }}</span>

              @if (category.description) {
                <span class="category-description">{{ category.challengeCount ? category.description : 'Coming Soon' }}</span>
              }

            </div>
          </div>

          <div class="category-meta">
            @if (category.challengeCount !== undefined) {
              <span
                class="challenge-count"
                [attr.aria-label]="category.challengeCount + ' challenges'"
              >
                {{ category.challengeCount }}
              </span>
            }

            @if (category.newBadgeCount && category.newBadgeCount > 0) {
              <span
                class="new-badge"
                [attr.aria-label]="category.newBadgeCount + ' new challenges'"
              >
                {{ category.newBadgeCount }} New
              </span>
            }
          </div>
        </button>
      }
    }
  </div>
</aside>
}
