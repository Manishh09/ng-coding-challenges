<!-- Backdrop for mobile drawer -->
@if (isMobile() && isOpen()) {
  <div
    class="sidebar-backdrop"
    (click)="onBackdropClick()"
    aria-hidden="true"
  ></div>
}

<!-- Sidebar/Drawer -->
<aside
  class="category-sidebar"
  [class.open]="isOpen()"
  [class.mobile]="isMobile()"
  role="navigation"
  aria-label="Challenge categories navigation"
>
  <!-- Sidebar Header -->
  <div class="sidebar-header">
    <div class="header-title">
      <mat-icon class="header-icon">category</mat-icon>
      <h2>Categories</h2>
    </div>

    @if (isMobile()) {
      <button
        mat-icon-button
        (click)="closeDrawer.emit()"
        aria-label="Close categories menu"
        class="close-button"
      >
        <mat-icon>close</mat-icon>
      </button>
    }
  </div>

  <!-- Search Bar -->
  <div class="sidebar-search">
    <app-search-bar
      [placeholder]="'Search categories...'"
      [debounceTime]="200"
      [ariaLabel]="'Search categories'"
      (searchChange)="onSearchChange($event)"
      (searchClear)="onSearchClear()"
    />
  </div>

  <!-- Category List -->
  <div class="category-list">
    @if (hasNoResults()) {
      <div class="empty-state">
        <mat-icon class="empty-icon">search_off</mat-icon>
        <p class="empty-text">No categories found</p>
      </div>
    } @else {
      @for (category of filteredCategories(); track category.id) {
        <button
          class="category-item"
          [class.selected]="isSelected(category.id)"
          (click)="selectCategory(category.id)"
          matRipple
          [matRippleColor]="'var(--color-primary-alpha-10)'"
          [attr.aria-label]="'Select ' + category.name + ' category'"
          [attr.aria-current]="isSelected(category.id) ? 'page' : null"
        >
          <div class="category-content">
            <mat-icon class="category-icon">
              {{ getCategoryIcon(category.id) }}
            </mat-icon>

            <div class="category-info">
              <span class="category-name">{{ category.name }}</span>

              @if (category.description) {
                <span class="category-description">{{ category.description }}</span>
              }
            </div>
          </div>

          <div class="category-meta">
            @if (category.challengeCount !== undefined) {
              <span
                class="challenge-count"
                [attr.aria-label]="category.challengeCount + ' challenges'"
              >
                {{ category.challengeCount }}
              </span>
            }

            @if (category.newBadgeCount && category.newBadgeCount > 0) {
              <span
                class="new-badge"
                [attr.aria-label]="category.newBadgeCount + ' new challenges'"
              >
                {{ category.newBadgeCount }} New
              </span>
            }
          </div>
        </button>
      }
    }
  </div>
</aside>
