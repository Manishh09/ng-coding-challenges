<div class="email-form-container">
  <!-- Success Message -->
  @if (showSuccessMessage()) {
  <div class="alert alert-success">
    {{ successMessage() }}
  </div>
  }

  <div class="main-content">
    <!-- Left Side: Form Section -->
    <div class="form-section">
      <!-- Form Header -->
      <div class="form-header">
        <h2>Email Registration</h2>
        <p class="form-subtitle">Test the async email availability validator with real-time feedback</p>
      </div>

      <!-- Registration Form -->
      <form [formGroup]="emailForm" (ngSubmit)="onSubmit()" class="email-form">

        <!-- Email Field -->
        <div class="form-group">
          <label for="email" class="form-label">
            Email Address <span class="required">*</span>
          </label>
          <input type="email" id="email" formControlName="email" class="form-control" [ngClass]="getFieldClass('email')"
            placeholder="Enter your email address" />

          <!-- Loading Indicator (PENDING state) -->
          @if (isValidating()) {
          <div class="loading-indicator">
            <span class="spinner"></span>
            <span>Checking email availability...</span>
          </div>
          }

          <!-- Error Messages -->
          @if (shouldShowValidation('email') && !isValidating() && getErrorMessage('email')) {
          <div class="error-message">
            <span class="error-icon">‚ö†</span>
            {{ getErrorMessage('email') }}

            <!-- Suggested Alternatives -->
            @if (getSuggestedEmails().length > 0) {
            <div class="suggestions">
              <strong>Try these instead:</strong>
              <ul>
                @for (suggestion of getSuggestedEmails(); track suggestion) {
                <li>{{ suggestion }}</li>
                }
              </ul>
            </div>
            }
          </div>
          }

          <!-- Success Indicator (VALID state) -->
          @if (shouldShowValidation('email') && !isValidating() && !getErrorMessage('email')) {
          <div class="success-message">
            <span class="success-icon">‚úì</span>
            Email is available!
          </div>
          }

          <!-- Field Hints -->
          <small class="form-hint">
            We'll check if this email is already registered. Please wait for validation.
          </small>
        </div>

        <!-- Full Name Field -->
        <div class="form-group">
          <label for="fullName" class="form-label">
            Full Name <span class="required">*</span>
          </label>
          <input type="text" id="fullName" formControlName="fullName" class="form-control"
            [ngClass]="getFieldClass('fullName')" placeholder="Enter your full name" />

          <!-- Error Messages -->
          @if (shouldShowValidation('fullName') && getErrorMessage('fullName')) {
          <div class="error-message">
            <span class="error-icon">‚ö†</span>
            {{ getErrorMessage('fullName') }}
          </div>
          }

          <!-- Success Indicator -->
          @if (shouldShowValidation('fullName') && !getErrorMessage('fullName')) {
          <div class="success-message">
            <span class="success-icon">‚úì</span>
            Name is valid
          </div>
          }

          <!-- Field Hints -->
          <small class="form-hint">
            3-50 characters. Please enter your real name.
          </small>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="isSubmitDisabled()">
            @if (isValidating()) {
            <span>Validating...</span>
            } @else {
            <span>Register</span>
            }
          </button>
        </div>

        <!-- Form Status -->
        @if (submitted() && emailForm.invalid) {
        <div class="form-status error">
          <strong>Form has errors.</strong> Please fix the issues above before submitting.
        </div>
        }

        @if (emailForm.pending) {
        <div class="form-status pending">
          <strong>Validation in progress.</strong> Please wait...
        </div>
        }
      </form>
    </div>

    <!-- Right Side: Taken Emails List -->
    <!-- For DEMO only -->
    <div class="taken-emails-section">
      <div class="list-header">
        <h3>Already Registered Emails</h3>
        <p class="list-description">
          Real emails from JSONPlaceholder API. Try entering them to see the async validator in action.
        </p>
      </div>

      <div class="emails-list">
        @if (takenEmails().length === 0) {
        <div class="loading-state">
          <span class="spinner"></span>
          <span>Loading emails...</span>
        </div>
        } @else {
        @for (email of takenEmails(); track email) {
        <div class="email-item">
          <span class="email-icon">üìß</span>
          <span class="email-text">{{ email }}</span>
        </div>
        }
        }
      </div>
    </div>
  </div>

  <!-- Validation Examples -->
  <!-- For DEMO only -->
  <div class="examples-section">
    <h3>Async Validation Examples</h3>
    <div class="examples-grid">
      <div class="example-card">
        <h4>‚úÖ Available Emails</h4>
        <ul>
          <li><code>newuser&#64;example.com</code></li>
          <li><code>myname&#64;company.com</code></li>
          <li><code>hello&#64;world.io</code></li>
        </ul>
        <p class="note">These emails will pass validation after ~1.5s delay</p>
      </div>

      <div class="example-card">
        <h4>‚ùå Taken Emails (from API)</h4>
        <ul>
          <li><code>Sincere&#64;april.biz</code></li>
          <li><code>Shanna&#64;melissa.tv</code></li>
          <li><code>Nathan&#64;yesenia.net</code></li>
        </ul>
        <p class="note">Real emails from JSONPlaceholder API - try these to see validation</p>
      </div>

      <div class="example-card">
        <h4>üîÑ Async Features</h4>
        <ul>
          <li>500ms debounce delay</li>
          <li>Real API call to JSONPlaceholder</li>
          <li>Loading spinner during validation</li>
          <li>Previous requests cancelled (switchMap)</li>
          <li>Case-insensitive matching</li>
        </ul>
        <p class="note">Submit button disabled while validating</p>
      </div>
    </div>
  </div>
</div>
